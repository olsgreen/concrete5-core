!function(a,b){"use strict";function c(a,c){var d=this;c=b.extend({setID:"",repetition:"",template:"script[data-template=duration-wrapper]",dateFormat:""},c),d.options=c,d.$element=a,d.setID=c.setID;var e=d.prepareRepetition(d.options.repetition);d.repetition=e;var f=_.template(b(c.template).html(),e);d.$element.append(f),d.setup()}function d(a,d){var e=this;d=b.extend({template:"script[data-template=duration-wrapper]",dateFormat:"",repetitions:[]},d),e.options=d,b.each(e.options.repetitions,function(d,f){var g=b("<div />"),h=(new Date).getTime(),i=new c(g,{repetition:f,setID:h,dateFormat:e.options.dateFormat,template:e.options.template});a.append(i.getElement())})}c.prototype={getElement:function(){var a=this;return a.$element},getSetID:function(){var a=this;return a.setID},prepareRepetition:function(a){var c=this,d=new Date(a.pdStartDate);if(a.setID=c.setID,a.pdStartDate=b.datepicker.formatDate("yy-mm-dd",d),a.pdStartDateSelectTime=c.getTimeFromDate(d,!0),a.pdEndDateSelectTime=!1,a.pdEndDate){var e=new Date(a.pdEndDate);a.pdEndDate=b.datepicker.formatDate("yy-mm-dd",e),a.pdEndDateSelectTime=c.getTimeFromDate(e)}return console.log(a),a},setupTimes:function(){var a=this;a.$element.find("select[data-select=start-time]").selectize({onChange:function(b){a.calculateEndDate()}}),a.$element.find("select[data-select=end-time]").selectize({copyClassesToDropdown:!1})},getSelectedEndDate:function(){var a=this,c=a.$element.find("input[name=pdEndDate_pub_"+a.getSetID()+"]").datepicker("option","altFormat"),d=a.$element.find("input[name=pdEndDate_"+a.getSetID()+"]").val();if(d){var e=b.datepicker.parseDate(c,d),f=a.$element.find("select[name=pdEndDateSelectTime_"+a.getSetID()+"]").val();if(f){var g=f.split(/:/gi)[0],h=f.split(/:/gi)[1].replace(/\D/g,"");return f.match("/pm/i")&&g<12&&(g=parseInt(g)+12),new Date(e.getFullYear(),e.getMonth(),e.getDate(),g,h,0)}}},getSelectedStartDate:function(){var a=this,c=a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").datepicker("option","altFormat"),d=a.$element.find("input[name=pdStartDate_"+a.getSetID()+"]").val();if(d){var e=b.datepicker.parseDate(c,d),f=a.$element.find("select[name=pdStartDateSelectTime_"+a.getSetID()+"]").val();if(f){var g=f.split(/:/gi)[0],h=f.split(/:/gi)[1].replace(/\D/g,"");return f.match(/pm/i)&&g<12?g=parseInt(g)+12:f.match(/am/i)&&12==g&&(g=0),new Date(e.getFullYear(),e.getMonth(),e.getDate(),g,h,0)}}},getTimeFromDate:function(a,b){var c,d,e=a.getMinutes();if(0==a.getHours()?(c=12,d="am"):a.getHours()>11?(d="pm",c=a.getHours()>12?a.getHours()-12:a.getHours()):(c=a.getHours(),d="am"),e<10&&(e="0"+e),b){var f=c+":00"+d;if(e>29)var f=c+":30"+d}else var f=c+":"+e+d;return f},calculateEndDate:function(){var a=this,c=a.getSelectedStartDate();if(c){var d=c,e=a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").datepicker("option","dateFormat");d.setTime(c.getTime()+36e5);var f=b.datepicker.formatDate(e,d),g=a.getTimeFromDate(d,!1);a.$element.find("input[name=pdEndDate_pub_"+a.getSetID()+"]").datepicker("setDate",f);var h=a.$element.find("select[name=pdEndDateSelectTime_"+a.getSetID()+"]").selectize();h[0].selectize.setValue(g)}},setupDates:function(){var a=this;a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").datepicker({dateFormat:a.options.dateFormat,altFormat:"yy-mm-dd",altField:a.$element.find("input[name=pdStartDate_"+a.getSetID()+"]"),changeYear:!0,showAnim:"fadeIn",yearRange:"c-100:c+10"}),a.$element.find("input[name=pdEndDate_pub_"+a.getSetID()+"]").datepicker({dateFormat:a.options.dateFormat,altFormat:"yy-mm-dd",altField:a.$element.find("input[name=pdEndDate_"+a.getSetID()+"]"),changeYear:!0,showAnim:"fadeIn",yearRange:"c-100:c+10"}),a.$element.find("input[name=pdEndRepeatDateSpecific_pub_"+a.getSetID()+"]").datepicker({dateFormat:a.options.dateFormat,altFormat:"yy-mm-dd",altField:a.$element.find("input[name=pdEndRepeatDateSpecific_"+a.getSetID()+"]"),changeYear:!0,showAnim:"fadeIn",yearRange:"c-100:c+10"}),a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").datepicker("setDate",a.getSelectedStartDate()),a.$element.find("input[name=pdEndDate_pub_"+a.getSetID()+"]").datepicker("setDate",a.getSelectedEndDate()),a.$element.find("input[name=pdEndRepeatDateSpecific_pub_"+a.getSetID()+"]").datepicker("setDate",new Date(a.$element.find("input[name=pdEndRepeatDateSpecific_pub_"+a.getSetID()+"]").val())),a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").datepicker({onSelect:function(){b(this).trigger("change")}}),a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").on("change",function(){a.$element.find("input[name=pdEndDate_pub_"+a.getSetID()+"]").datepicker("setDate",b(this).val())})},setupRepeatOptions:function(){var a=this;a.$element.find("div[data-wrapper=duration-repeat] input[type=checkbox]").click(function(){a.onActivateDates()}),a.$element.find("select[name=pdRepeatPeriod_"+a.getSetID()+"]").change(function(){a.onRepeatPeriodChange()}),a.$element.find("input[name=pdRepeat_"+a.getSetID()+"]").click(function(){a.checkRepeat()}),a.$element.find("div[data-wrapper=duration-repeat-dates] input.ccm-input-date").attr("disabled",!0),a.$element.find("input[name=pdEndRepeatDate_"+a.getSetID()+"]").change(function(){a.calculateRepeatEnd()})},calculateRepeatOptions:function(){var a=this,c=a.getSelectedStartDate(),d=a.getSelectedEndDate(),e=d.getTime()/1e3-c.getTime()/1e3,f=a.$element.find("div[data-wrapper=duration-repeat-weekly-dow]");switch(e>=86400?(a.$element.find("select[name=pdRepeatPeriod_"+a.getSetID()+"] option[value=daily]").prop("disabled",!0),f.hide()):(a.$element.find("select[name=pdRepeatPeriod_"+a.getSetID()+"] option[value=daily]").prop("disabled",!1),f.show()),b("input[name=pdStartRepeatDate_"+a.getSetID()+"]").val(a.$element.find("input[name=pdStartDate_pub_"+a.getSetID()+"]").val()),c.getDay()){case 0:f.find("input[value=0]").attr("checked",!0);break;case 1:f.find("input[value=1]").attr("checked",!0);break;case 2:f.find("input[value=2]").attr("checked",!0);break;case 3:f.find("input[value=3]").attr("checked",!0);break;case 4:f.find("input[value=4]").attr("checked",!0);break;case 5:f.find("input[value=5]").attr("checked",!0);break;case 6:f.find("input[value=6]").attr("checked",!0)}},checkRepeat:function(){var a=this;a.$element.find("input[name=pdRepeat_"+a.getSetID()+"]").is(":checked")?a.$element.find("div[data-wrapper=duration-repeat-selector]").show():a.$element.find("div[data-wrapper=duration-repeat-selector]").hide()},onActivateDates:function(){var a=this;a.calculateRepeatOptions(),a.$element.find("div[data-wrapper=duration-repeat]").show(),a.$element.find("input[name=pdStartDateAllDayActivate_"+a.getSetID()+"]").attr("disabled",!1),a.$element.find("input[name=pdStartDateAllDayActivate_"+a.getSetID()+"]").is(":checked")?(a.$element.find("div[data-column=date]").removeClass().addClass("col-sm-12"),a.$element.find("select[data-select=start-time]").parent().hide(),a.$element.find("select[data-select=end-time]").parent().hide()):(a.$element.find("div[data-column=date]").removeClass().addClass("col-sm-6"),a.$element.find("select[data-select=start-time]").parent().show(),a.$element.find("select[data-select=end-time]").parent().show())},onRepeatPeriodChange:function(){var a=this;a.$element.find("div[data-wrapper=duration-dates-repeat-daily]").hide(),a.$element.find("div[data-wrapper=duration-dates-repeat-weekly]").hide(),a.$element.find("div[data-wrapper=duration-dates-repeat-monthly]").hide();var b=a.$element.find("select[name=pdRepeatPeriod_"+a.getSetID()+"]").val();""!=b&&(a.$element.find("div[data-wrapper=duration-dates-repeat-"+b+"]").show(),a.$element.find("div[data-wrapper=duration-repeat-dates]").show())},calculateRepeatEnd:function(){var a=this;"date"==a.$element.find("input[name=pdEndRepeatDate_"+a.getSetID()+"]:checked").val()?a.$element.find("div[data-wrapper=duration-repeat-dates] input[name=pdEndRepeatDateSpecific_pub_"+a.getSetID()+"]").prop("disabled",!1):a.$element.find("div[data-wrapper=duration-repeat-dates] input[name=pdEndRepeatDateSpecific_pub_"+a.getSetID()+"]").prop("disabled",!0)},setup:function(){var a=this;a.setupDates(),a.setupTimes(),a.setupRepeatOptions(),a.repetition.pdEndDate||a.calculateEndDate(),a.calculateRepeatOptions(),a.onActivateDates(),a.checkRepeat(),a.onRepeatPeriodChange(),a.calculateRepeatEnd()}},b.fn.concreteDurationSelector=function(a){return b.each(b(this),function(c,e){new d(b(this),a)})},a.ConcreteDurationSelector=d}(this,$);