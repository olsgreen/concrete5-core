!function(a,b){"use strict";function c(a){return a=null===a||a===b?"":a.toString(),a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),a=a.replace(/ /g,'<span class="ccm-translator-original-space"> </span>'),a=a.replace(/\t/g,'<span class="ccm-translator-original-tab"> </span>'),a=a.replace(/\n/g,'<span class="ccm-translator-original-lf"></span><br />'),a=a.replace(/(%(\d+\$)?[a-z])/g,'<span class="ccm-translator-original-copy">$1</span>'),a=a.replace(/(&lt;\/?[a-zA-Z].*?&gt;)/g,'<span class="ccm-translator-original-copy">$1</span>')}function d(a,b){var c;return c=/^(\s+)\S/.exec(a),c&&(b=c[1]+b),c=/^\S(\s+)$/.exec(a),c&&(b+=c[1]),b}function e(b,c){a.extend(this,b),this.hasContext="context"in b,this.isPlural="originalPlural"in b,this.isTranslated="translations"in b,this.translator=c,!this.translator.approvalSupport||"isApproved"in b||(this.isApproved=!1),this.translator.translations.push(this)}function f(b){this.containerID=b.container,this.height=b.height,this.saveAction=b.saveAction,this.plurals=a.extend(!0,{},b.plurals),this.translations=[],this.approvalSupport=b.approvalSupport!==!1,this.referencePatterns=a.extend(!0,{file:null,file_line:null},b.referencePatterns),this.on={uiLaunched:"onUILaunched"in b?b.onUILaunched:null,beforeActivatingTranslation:"onBeforeActivatingTranslation"in b?b.onBeforeActivatingTranslation:null,currentTranslationChanged:"onCurrentTranslationChanged"in b?b.onCurrentTranslationChanged:null},this.approvalSupport&&(this.canModifyApproved=b.canModifyApproved===!0);for(var c=0,d=b.translations.length;c<d;c++)new e(b.translations[c],this);this.busy=!1,this.getInitialTranslationIndex=b.getInitialTranslationIndex?b.getInitialTranslationIndex:null}if(!window.ccmTranslator){var g=500,h={AskDiscardDirtyTranslation:"The current item has changed.\nIf you proceed you will lose your changes.\n\nDo you want to proceed anyway?",Approved:"Approved",Comments:"Comments",Context:"Context",ExamplePH:"Example: %s",Filter:"Filter",No_newlines_in_translations_please:"Please don't use new lines in translations (there's no new line in the source string)",Original_String:"Original String",Please_fill_in_all_plurals:"Please fill-in all plural forms",Plural_Original_String:"Plural Original String",References:"References",Save_and_Continue:"Save & Continue",Search_for_:"Search for...",Search_in_contexts:"Search in contexts",Search_in_originals:"Search in originals",Search_in_translations:"Search in translations",Show_approved:"Show approved",Show_translated:"Show translated",Show_unapproved:"Show unapproved",Show_untranslated:"Show untranslated",Singular_Original_String:"Singular Original String",Toggle_Dropdown:"Toggle Dropdown",TAB:"[TAB] Forward",TAB_SHIFT:"[SHIFT]+[TAB] Backward",Translate:"Translate",Translation:"Translation",TranslationIsApproved_WillNeedApproval:"This translation is approved: your changes will need approval.",TranslationIsNotApproved:"This translation is not approved.",PluralNames:{zero:"Zero",one:"One",two:"Two",few:"Few",many:"Many",other:"Other"}},i={colFilter:"col-md-12",colOriginal:"col-md-6",colTranslations:"col-md-6"};e.prototype={buildListItem:function(){var a=this;this.li=document.createElement("li"),this.li.ccmTranslation=this,this.li.className="list-group-item clearfix"+(this.isTranslated?" list-group-item-success":"");var b=document.createElement("span");b.textContent=b.innerText=this.original,this.li.appendChild(b),this.liTranslated=document.createElement("span"),this.translationUpdated(!0),this.li.appendChild(this.liTranslated),this.translator.UI.$list[0].appendChild(this.li),this.li.onclick=function(){a.translator.setCurrentTranslation(a)}},translationUpdated:function(b){this.liTranslated.textContent=this.liTranslated.innerText=this.isTranslated?this.translations[0]:"",b!==!0&&(this.isTranslated?a(this.li).addClass("list-group-item-success"):a(this.li).removeClass("list-group-item-success"))},translatedSaved:function(a,b){null===a?(delete this.translations,this.isTranslated=!1,this.translator.approvalSupport&&(this.isApproved=!1)):(this.translations=a,this.isTranslated=!0,!this.translator.approvalSupport||b!==!0&&b!==!1||(this.isApproved=b)),this.translationUpdated()},contextContains:function(a){return this.hasContext!==!1&&this.context.toLowerCase().indexOf(a)>=0},originalContains:function(a){return this.original.toLowerCase().indexOf(a)>=0||this.isPlural===!0&&this.originalPlural.toLowerCase().indexOf(a)>=0},translationContains:function(a){if(this.isTranslated===!1)return!1;for(var b=this.translations.length,c=0;c<b;c++)if(this.translations[c].toLowerCase().indexOf(a)>=0)return!0;return!1},satisfyFilter:function(a){if(a.showTranslated===!1&&this.isTranslated===!0)return!1;if(a.showUntranslated===!1&&this.isTranslated===!1)return!1;if(a.showApproved===!1&&this.isApproved===!0)return!1;if(a.showUnapproved===!1&&this.isApproved===!1)return!1;if(a.text.length>0){var b=!1;if(b=b||a.searchInContexts&&this.contextContains(a.lowerCaseText),b=b||a.searchInOriginals&&this.originalContains(a.lowerCaseText),b=b||a.searchInTranslations&&this.translationContains(a.lowerCaseText),b===!1)return!1}return!0},applyFilter:function(){this.li.style.display=this.satisfyFilter(this.translator.appliedFilter)?"":"none"}};var j=function(){function b(b){if(this.UI={},this.translation=b,this.UI.$container=this.translation.translator.UI.$translation,this.UI.$container.empty(),this.UI.$container.closest(".panel").css("visibility","visible"),this.buildOriginalUI(),this.buildTranslationUI(),this.translation.translator.approvalSupport&&(this.translation.translator.canModifyApproved?this.UI.$container.append(a('<label class="control-label inline" />').text(h.Approved).prepend(this.UI.$approved=a('<input type="checkbox" '+(this.translation.isApproved?' checked="checked"':"")+" />"))):this.UI.$container.append(a("<p />").text(this.translation.isApproved?h.TranslationIsApproved_WillNeedApproval:h.TranslationIsNotApproved))),"comments"in this.translation||"context"in this.translation||"references"in this.translation){var c;if(this.UI.$container.append(c=a("<dl />")),"comments"in this.translation&&c.append(a("<dt />").text(h.Comments)).append(a("<dd />").text(this.translation.comments)),"context"in this.translation&&c.append(a("<dt />").text(h.Context)).append(a("<dd />").text(this.translation.context)),"references"in this.translation){var d,e=this.translation.translator.referencePatterns;c.append(a("<dt />").text(h.References)).append(d=a('<dd style="overflow: hidden; white-space: pre" />')),a.each(this.translation.references,function(b,c){b>0&&d.append("<br />");var f,g;c.length>1&&null!==c[1]?(f=c.join(":"),g=e.file_line):(f=c[0],g=e.file),g?d.append(a('<a target="_blank" />').text(f).attr("href",g.replace(/\[\[FILE\]\]/g,c[0]).replace(/\[\[LINE\]\]/g,c[1]))):d.append(a("<span />").text(f))}),d.attr("title",d.text())}}var f=a(this.translation.li);f.addClass("list-group-item-info");var g=null,i=f.closest("ul"),j=f.position().top-i.position().top,k=i.scrollTop();if(j<0)g=k+j;else{var l=j+f.outerHeight(),m=i.height();l>m&&(g=k+(l-m))}null!==g&&i.animate({scrollTop:g},50)}function e(a){b.call(this,a)}function f(a){b.call(this,a)}return b.prototype={getTranslatedState:function(a){var b=this.getTranslatedStrings(a);if(null===b||b===!1)return b;var c={strings:b};return"$approved"in this.UI&&(c.approved=!!this.UI.$approved.is(":checked")),c},isDirty:function(){var a=this.getTranslatedState();if(null===a)return!!this.translation.isTranslated;if(this.translation.isTranslated===!1)return!0;for(var b=!1,c=a.strings.length,d=0;d<c;d++)if(a.strings[d]!==this.translation.translations[d]){b=!0;break}return"approved"in a&&a.approved!==this.translation.isApproved&&(b=!0),b},buildOriginalUI:function(){var b=this;b._buildOriginalUI(),b.UI.$container.find("div.ccm-translator-original span.ccm-translator-original-copy").on("click",function(){b.translation.translator.setTranslationText(a(this).text(),!1)})},dispose:function(){a(this.translation.li).removeClass("list-group-item-info"),this.UI.$container.empty().closest(".panel").css("visibility","hidden")}},a.extend(!0,e.prototype,b.prototype,{_buildOriginalUI:function(){this.UI.$container.append(a('<div class="form-group" />').append(a('<label class="control-label" />').text(h.Original_String)).append(a('<div class="form-control ccm-translator-original" />').html(c(this.translation.original))))},buildTranslationUI:function(){this.UI.$container.append(a('<div class="form-group" />').append(a('<label class="control-label" />').text(h.Translation)).append(this.UI.$translated=a('<textarea rows="5" class="form-control" />').val(this.translation.isTranslated?this.translation.translations[0]:""))),this.UI.$translated.focus()},getCurrentTextInput:function(){return this.UI.$translated},getTranslatedStrings:function(b){var c=a.trim(this.UI.$translated.val());return""===c?null:(c=d(this.translation.original,c),b&&c.indexOf("\n")>=0&&this.translation.original.indexOf("\n")<0?(window.alert(h.No_newlines_in_translations_please),!1):[c])}}),a.extend(!0,f.prototype,b.prototype,{_buildOriginalUI:function(){this.UI.$container.append(a('<div class="form-group" />').append(a('<label class="control-label" />').text(h.Singular_Original_String)).append(a('<div class="form-control ccm-translator-original" />').html(c(this.translation.original)))).append(a('<div class="form-group" />').append(a('<label class="control-label" />').text(h.Plural_Original_String)).append(a('<div class="form-control ccm-translator-original" />').html(c(this.translation.originalPlural))))},showTranslationTab:function(a,b){this.UI.$tabHeaders.find("li.active").removeClass("active"),this.UI.$tabBodies.find(".tab-pane.active").removeClass("active"),this.UI.$tabHeaders.find('li[data-key="'+a+'"]').addClass("active");var c=this.UI.$tabBodies.find('.tab-pane[data-key="'+a+'"]').addClass("active");b&&c.find("textarea,input").focus()},buildTranslationUI:function(){var b=this;this.UI.$container.append(a('<div class="form-group" />').append(a('<label class="control-label" />').text(h.Translation)).append(this.UI.$tabHeaders=a('<ul class="nav nav-tabs" />')).append(this.UI.$tabBodies=a('<div class="tab-content" />')));var c=0;this.UI.$translated={};var d=null;a.each(this.translation.translator.plurals,function(e,f){null===d&&(d=e),b.UI.$tabHeaders.append(a('<li data-key="'+e+'"'+(0===c?' class="active"':"")+" />").append(a('<a href="#" />').text(h.PluralNames[e]))),b.UI.$tabBodies.append(a('<div class="tab-pane'+(0===c?" active":"")+'" data-key="'+e+'" />').append(a("<p />").text(h.ExamplePH.replace(/%s/,f))).append(b.UI.$translated[e]=a('<textarea rows="5" class="form-control" />').val(b.translation.isTranslated?b.translation.translations[c]:""))),c++}),this.UI.$tabHeaders.find("a").on("click",function(c){c.preventDefault(),b.showTranslationTab(a(this).closest("li").attr("data-key"))}),this.UI.$translated[d].focus()},getCurrentTextInput:function(){return this.UI.$tabBodies.find(".tab-pane.active").find("textarea,input")},getTranslatedStrings:function(b){var c=this,e=[],f=this.translation.original,g=(this.translation.original+this.translation.originalPlural).indexOf("\n")>=0,i=!1,j=null,k=null;if(a.each(this.translation.translator.plurals,function(b){var h=a.trim(c.UI.$translated[b].val());h.length>0?(i=!0,g===!1&&h.indexOf("\n")>=0&&(k=b),h=d(f,h)):null===j&&(j=b),e.push(h)}),i===!1)return null;if(b===!0){if(null!==k)return this.showTranslationTab(k,!0),window.alert(h.No_newlines_in_translations_please),!1;if(null!==j)return this.showTranslationTab(j,!0),window.alert(h.Please_fill_in_all_plurals),!1}return e}}),{Singular:e,Plural:f}}();f.prototype={launch:function(){var b=this;this.UI={},this.UI.$container=a(this.containerID),delete this.containerID;var c=this.height;delete this.height,(!c||c<200)&&(c=200),this.UI.$container.append(a('<div class="row" />').append(a('<div class="'+i.colFilter+'" />').append(a('<div class="panel panel-info" />').append(a('<div class="panel-heading" />').append(a('<div class="panel-title" />').text(h.Filter))).append(a('<div class="panel-body" />').append(a('<div class="input-group">').append(a('<div class="input-group-btn" />').append(this.UI.$showTranslated=a('<a href="javascript:void(0)" class="btn btn-default" />').text(h.Show_translated)).append(this.UI.$showUntranslated=a('<a href="javascript:void(0)" class="btn btn-default" />').text(h.Show_untranslated))).append(this.UI.$searchText=a('<input type="text" class="form-control" />').attr("placeholder",h.Search_for_)).append(a('<div class="input-group-btn" />').append(this.UI.$searchButton=a('<button type="button" class="btn btn-primary"><span class="fa fa-search"></span></button>')).append(a('<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false" />').append(a('<span class="caret" />'))).append(a('<ul class="dropdown-menu dropdown-menu-right" role="menu" />').append(a("<li />").append(this.UI.$searchInOriginals=a('<a href="javascript:void(0)" />').text(" "+h.Search_in_originals).prepend(a('<i class="fa" />')))).append(a("<li />").append(this.UI.$searchInTranslations=a('<a href="javascript:void(0)" />').text(" "+h.Search_in_translations).prepend(a('<i class="fa" />')))).append(a("<li />").append(this.UI.$searchInContexts=a('<a href="javascript:void(0)" />').text(" "+h.Search_in_contexts).prepend(a('<i class="fa" />')))).append('<li class="divider"></li>').append(a("<li />").append(this.UI.$showUnapproved=a('<a href="javascript:void(0)" />').text(" "+h.Show_unapproved).prepend(a('<i class="fa" />')))).append(a("<li />").append(this.UI.$showApproved=a('<a href="javascript:void(0)" />').text(" "+h.Show_approved).prepend(a('<i class="fa" />'))))))))))).append(a('<div class="row" />').append(a('<div class="'+i.colOriginal+' ccm-translator-col-original" />').append(a('<div class="panel panel-primary" />').append(a('<div class="panel-heading clearfix" />').append(a("<span />").text(h.Original_String)).append(a("<span />").text(h.Translation))).append(this.UI.$list=a('<ul class="list-group" />').css("height",c+"px")))).append(a('<div class="'+i.colTranslations+' ccm-translator-col-translations" />').append(a('<div class="panel panel-primary" />').append(a('<div class="panel-heading" />').text(h.Translate)).append(this.UI.$translation=a('<div class="panel-body" />')).append(a('<div class="panel-footer" />').append(a('<button class="btn btn-primary ccm-translator-savecontinue" />').text(h.Save_and_Continue).on("click",function(){b.saveAndContinue()})).append(a('<small class="text-muted" style="margin-left: 20px" />').text(h.TAB)).append(a('<small class="text-muted" style="margin-left: 20px" />').text(h.TAB_SHIFT)))))),this.on.uiLaunched&&this.on.uiLaunched(this);var d=this.translations.length;if(d<g){this.UI.$searchButton.remove();var e=null;this.UI.$searchText.on("change keydown keyup keypress",function(){e&&clearTimeout(e),e=setTimeout(function(){e=null,b.filter()},100)})}else this.UI.$searchText.on("keypress",function(a){13===(a.keyCode||a.charCode)&&b.filter()}),this.UI.$searchButton.on("click",function(){b.filter()});for(var f=!1,j=0;j<d;j++)this.translations[j].buildListItem(),this.translations[j].hasContext&&(f=!0);if(this.appliedFilter={text:"",searchInOriginals:!0,searchInTranslations:!0,searchInContexts:!1,showUnapproved:!0,showApproved:!0,showTranslated:!0,showUntranslated:!0},this.UI.$searchInOriginals.on("click",function(){b.filter({searchInOriginals:!b.appliedFilter.searchInOriginals})}),this.UI.$searchInTranslations.on("click",function(){b.filter({searchInTranslations:!b.appliedFilter.searchInTranslations})}),this.UI.$showTranslated.on("click",function(){b.filter({showTranslated:!b.appliedFilter.showTranslated})}),this.UI.$showUntranslated.on("click",function(){b.filter({showUntranslated:!b.appliedFilter.showUntranslated})}),this.approvalSupport?(this.UI.$showUnapproved.on("click",function(){b.filter({showUnapproved:!b.appliedFilter.showUnapproved})}),this.UI.$showApproved.on("click",function(){b.filter({showApproved:!b.appliedFilter.showApproved})})):(this.UI.$showUnapproved.closest("li").prev().remove(),this.UI.$showUnapproved.remove(),this.UI.$showApproved.remove(),delete this.appliedFilter.showUnapproved,delete this.appliedFilter.showApproved,delete this.UI.$showUnapproved,delete this.UI.$showApproved),f?this.UI.$searchInContexts.on("click",function(){b.filter({searchInContexts:!b.appliedFilter.searchInContexts})}):this.UI.$searchInContexts.remove(),this.viewAppliedFilter(),a(window).on("beforeunload",function(){if(b.currentTranslationView&&b.currentTranslationView.isDirty())return h.AskDiscardDirtyTranslation}),d>0){var k=0;this.getInitialTranslationIndex&&(k=this.getInitialTranslationIndex()||0),this.setCurrentTranslation(this.translations[k])}this.UI.$container.on("keydown",function(a){switch(a.keyCode||a.which){case 9:a.preventDefault(),setTimeout(function(){b.saveAndContinue(!!a.shiftKey)},0)}})},viewAppliedFilter:function(){var a=this.appliedFilter;this.UI.$searchText.text()!==a.text&&this.UI.$searchText.text(a.text),this.UI.$searchInOriginals.find("i").removeClass("fa-check-square-o fa-square-o").addClass(a.searchInOriginals?"fa-check-square-o":"fa-square-o"),this.UI.$searchInTranslations.find("i").removeClass("fa-check-square-o fa-square-o").addClass(a.searchInTranslations?"fa-check-square-o":"fa-square-o"),this.UI.$searchInContexts.find("i").removeClass("fa-check-square-o fa-square-o").addClass(a.searchInContexts?"fa-check-square-o":"fa-square-o"),this.approvalSupport&&(this.UI.$showUnapproved.find("i").removeClass("fa-check-square-o fa-square-o").addClass(a.showUnapproved?"fa-check-square-o":"fa-square-o"),this.UI.$showApproved.find("i").removeClass("fa-check-square-o fa-square-o").addClass(a.showApproved?"fa-check-square-o":"fa-square-o")),this.UI.$showTranslated.removeClass("btn-default btn-primary").addClass(a.showTranslated?"btn-primary":"btn-default"),this.UI.$showUntranslated.removeClass("btn-default btn-primary").addClass(a.showUntranslated?"btn-primary":"btn-default")},filter:function(b){var c=this,d=a.extend(!0,{},this.appliedFilter,b,{text:this.UI.$searchText.val()}),e=!1;if(a.each(d,function(a,b){if(b!==c.appliedFilter[a]){switch(a){case"searchInOriginals":case"searchInTranslations":case"searchInContexts":if(""===c.appliedFilter.text)return}return e=!0,!1}}),this.appliedFilter=d,this.viewAppliedFilter(),e){this.appliedFilter.lowerCaseText=this.appliedFilter.text.toLowerCase();for(var f=this.translations.length,g=0;g<f;g++)this.translations[g].applyFilter()}},setCurrentTranslation:function(a){var b=this;if(b.busy)return!1;if(b.currentTranslationView){if(b.currentTranslationView.translation===a)return;if(b.currentTranslationView.isDirty()&&!window.confirm(h.AskDiscardDirtyTranslation))return}var c=function(){b.currentTranslationView&&(b.currentTranslationView.dispose(),b.currentTranslationView=null,b.on.currentTranslationChanged&&b.on.currentTranslationChanged(b)),a&&(b.currentTranslationView=a.isPlural?new j.Plural(a):new j.Singular(a),b.on.currentTranslationChanged&&b.on.currentTranslationChanged(b))};b.on.beforeActivatingTranslation?(b.setBusy(!0),b.on.beforeActivatingTranslation(b,a,function(a){b.setBusy(!1),a!==!1&&c()})):c()},setTranslationText:function(a,b){var c=this.currentTranslationView.getCurrentTextInput(),d=c.val();if(b)c.val(a);else if(""!==a){var e=c[0];if(e.focus(),"selectionStart"in e&&"selectionEnd"in e){var f=d.substring(0,e.selectionStart),g=d.substring(e.selectionEnd);e.value=f+a+g,e.selectionEnd=e.selectionStart=f.length+a.length}else window.document.selection&&window.document.selection.createRange?(e.focus(),document.selection.createRange().text=a):c.val(a)}return c.trigger("change"),c},setBusy:function(a){this.busy=!!a;var b=this.UI.$container.find("button.ccm-translator-savecontinue");this.busy?b.css("width",b.outerWidth()+"px").html('<span class="fa fa-spinner fa-spin"></span>'):b.css("width","auto").text(h.Save_and_Continue)},saveAndContinue:function(b){var c=this;if(!this.busy){if(this.currentTranslationView.isDirty()===!1)return void this.gotoNextTranslation(b);var d=this.currentTranslationView.getTranslatedState(!0);if(d!==!1){var e=this.currentTranslationView.translation,f={};f.id=e.id,null===d?f.clear=1:(f.translated=d.strings,"approved"in d&&(f.approved=d.approved?1:0)),this.setBusy(!0),a.isFunction(this.saveAction)?this.saveAction(e,f,function(a){c.setBusy(!1),a?window.alert(a):c.gotoNextTranslation(b)}):a.ajax({type:"POST",url:this.saveAction,data:f,dataType:"json"}).always(function(){c.setBusy(!1)}).fail(function(a){a.responseJSON&&a.responseJSON.errors?window.alert(a.responseJSON.errors.join("\n")):window.alert(a.responseText)}).done(function(a){return a&&a.error?void window.alert(a.errors.join("\n")):(e.translatedSaved(d.strings,d.approved),void c.gotoNextTranslation(b))})}}},gotoNextTranslation:function(b){var c=this.UI.$list.children(":visible");if(0===c.length)return void this.setCurrentTranslation(null);var d=0;if(this.currentTranslationView){var e=a.inArray(this.currentTranslationView.translation.li,c);b?e>=0&&(d=e-1,d<0&&(d=c.length-1)):e>=0&&e<c.length-1&&(d=e+1)}this.setCurrentTranslation(c[d].ccmTranslation)}};var k=function(){function a(){for(;c.length>0;)c.splice(0,1)[0].launch()}var b=!1,c=[];return{setDomReady:function(){b=!0,c.length&&a()},setTranslatorReady:function(d){c.push(d),b&&a()}}}();window.ccmTranslator={setI18NDictionart:function(b){a.extend(!0,h,b)},configureFrontend:function(b){a.isPlainObject(b)&&a.extend(i,b)},initialize:function(a){var b=new f(a);return k.setTranslatorReady(b),b},views:j},a(document).ready(function(){k.setDomReady()})}}(jQuery);